name: "CodeQL"

 

on:

  push:

    branches: [ master, codeql-improvements ]

  pull_request:

    # The branches below must be a subset of the branches above

    branches: [ master ]

  schedule:

    - cron: '20 6 * * 0'

 

jobs:

  analyze:

    name: Analyze

    runs-on: ubuntu-latest

 

    strategy:

      fail-fast: false

 

    steps:

    - name: Checkout repository

      uses: actions/checkout@v2

    

    - name: Initialize CodeQL

      uses: github/codeql-action/init@v1
      with:
        languages: cpp
        queries: security-and-quality

    # install four required dependencies with BSD native package manager:
    - name: Install dependencies
      run: |
        sudo apt-get update -y
        sudo apt-get install -y flex-old bison libncurses5-dev libncursesw5-dev

    # run configure file to generate the Makefile:
    - name: Create makefile
      run: sudo ./configure

    # debugging 
    - name: print makefile
      run: cat GNUmakefile
      
    # debugging 
    - name: print words list
      run: cat `pwd`/usr/share/dict/words

    # compile from source code based on newly created Makefile:
    - name: Build from source
      run: sudo make

    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v1